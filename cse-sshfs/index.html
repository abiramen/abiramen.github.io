<!doctype html><html lang=en><head><meta charset=utf-8><title>CSE and SSHFS | abiramen's site</title><link rel=stylesheet href=https://abiram.me/css/styles.css><link rel=stylesheet href=/assets/fonts/fonts.css><link type=application/atom+xml rel=alternate href=/feed.xml><link rel="shortcut icon" href=/assets/images/ramen-bricks.png type=image/x-icon><link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel=stylesheet><meta name=theme-color content="#000000"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=/assets/css/post.css><link rel=stylesheet href=/assets/css/tags.css><link rel=stylesheet href=/assets/vendor/littlefoot/littlefoot.css></head><body><nav id=navbar><div id=nav-contain><a href=/ id=navbar-logo><img src=/assets/images/ramen-logo.png alt=neon-logo id=logo></a><div id=nav-home><a href=/ id=navbar-name>@abiramen</a></div><div id=nav-right><a href=/about>about</a>
<a href=/posts>posts</a></div><img src=/assets/images/hamburger.svg alt=hamburger id=hamburger><div id=nav-border></div></div></nav><div id=overlay><span id=overlay-close>&#215;</span><div id=overlay-content><a href=/><img src=/assets/images/ramen-logo.png alt=neon-logo id=overlay-logo></a><h3>@abiramen</h3><a href=/about>about</a>
<a href=/posts>posts</a></div></div><main><div id=post-splash class=splash><div class=container><div id=splash-text class=post-desc><div id=post-head><span id=post-date>Aug 12, 2021 </span>Â·<div class=icon>schedule</div>8 min read</div><div id=post-title>CSE and SSHFS</div><div id=post-time></div><div id=post-desc>Stop killing CSE servers with this one simple trick!</div><div id=post-tags>tags:
<a class=tag-link href=/tags/archive><span class=post-tag>archive</span>
</a><a class=tag-link href=/tags/unsw-cse><span class=post-tag>unsw-cse</span>
</a><a class=tag-link href=/tags/guide><span class=post-tag>guide</span>
</a><a class=tag-link href=/tags/ssh><span class=post-tag>ssh</span></a></div></div></div><a id=scroll-arrow class="page-anchor-offset post-arrow" href=#post-contents><div class=icon>keyboard_arrow_down</div></a></div><div id=post-contents class=container><div class=alert><p>If you&rsquo;re a VS Code user who is in first year, or isn&rsquo;t too used to coding locally, you might be better off checking the easier method of using SSHFS with VS Code <a href=/cse-setup>here</a>
.</p></div><p>Hello! About a year and a half ago, I wrote a blogpost about setting up Visual Studio Code to connect to CSE machines using the &lsquo;Remote - SSH&rsquo; extension.</p><p>In hindsight, this was a <strong>terrible mistake</strong> with consequences I could not have foreseen. It turns out that the extension spawns a nodejs server on the remote machine for each connection, which requires an <em>intense</em> amount of resources <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>Anyhow, this guide steps through setting up SSHFS to mount and access your CSE filesystem from your local file system! Doing so allows you to access files on CSE machines as if they are on your own computer, and automatically synchronises any changes to files. This method likely uses less than a tenth of the resources required by the VS Code remote extension!</p><h2 id=who-is-this-guide-for>Who is this guide for?</h2><p>If you&rsquo;ve reached the end of the first year of your CSE degree, you <strong>probably</strong> should have a local coding setup by now, whether that be:</p><ul><li>a native Linux (or *nix) setup, or</li><li>some form of macOS setup, or</li><li>WSL 2 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li></ul><p>In that case, I highly recommend using SSHFS if you find yourself needing to work with files directly on CSE machines. If you&rsquo;re in first year and feeling adventurous, you can take a try at setting it up too, but you&rsquo;re probably better off following <a href=/cse-setup>this guide</a>
. <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></p><h2 id=getting-started->Getting started ðŸŽ‰</h2><p><em><strong>obligatory disclaimer</strong>: despite being employed by cse at the time of writing, this does <strong>not</strong> reflect the views of my employer. you get it, don&rsquo;t you?</em> ðŸ‘ŒðŸ‘Œ</p><p>Now that that&rsquo;s out of the way, we&rsquo;ll need to install SSHFS to get started.</p><h3 id=linux-and-wsl-2>Linux and WSL 2</h3><p>Otherwise, all you&rsquo;ll need to do is <strong>open a terminal</strong> and run <code>sudo apt install -y openssh-client sshfs</code> on your own computer.</p><h3 id=macos>macOS</h3><ol start=2><li><strong>Install MacFUSE</strong> Run <code>brew install --cask macfuse</code> in your terminal. Go to System Preferences â†’ Security & Privacy, enable the new system extension, then restart.</li><li><strong>Install sshfs</strong> Run <code>brew install gromgit/fuse/sshfs-mac</code> in your terminal and follow any steps which pop up.</li></ol><h2 id=mounting-your-cse-home-directory>Mounting your CSE home directory</h2><p>Our goal is to be able to access our CSE files from our own computer. To do this, we&rsquo;ll need to use SSHFS to <strong>mount</strong> them.</p><ol><li><strong>If this is your first time, make a directory</strong> in your local home directory by running <code>mkdir ~/cse</code> from a terminal. If you want to use a different folder name, feel free to do so, but make sure to use it instead in any future commands. It&rsquo;s important that this is an empty folder.</li><li><strong>Run the following command:</strong> <code>sshfs -o idmap=user -C z5555555@loginX.cse.unsw.edu.au: ~/cse</code>, replacing with your own zID, and replacing the X with the last digit of your zID. For example, if your zID was z5123456, you&rsquo;d use <code>login6.cse.unsw.edu.au</code>.</li></ol><p>Yay! Your CSE files should now be accessible in the <code>~/cse</code> directory! You can now access them with the text editor of your choice! For example, if you&rsquo;re a VS Code user, you can run <code>code ~/cse</code> to open a new workspace <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><p><strong>Once you&rsquo;re done working</strong>, you should unmount the CSE filesystem. To do this, run <code>fusermount -u ~/cse</code> on Linux, or <code>unmount -f ~/cse</code> on macOS<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>.</p><p><img src=/assets/images/blog/cse-sshfs/sshfs-workflow.png alt="Your SSHFS workflow, although you won&rsquo;t need to make a directory each time"></p><p>In order to get a shell on CSE machines and run commands such as <code>autotest</code> and <code>give</code>, you&rsquo;ll need to run <code>ssh z5555555@loginX.cse.unsw.edu.au</code>, (again, with your own zID, and replacing X with the last digit of your zID) and type in &lsquo;yes&rsquo; if any prompts appear. Use <kbd>Ctrl</kbd>+<kbd>D</kbd> to exit when you&rsquo;re done.</p><p><img src=/assets/images/blog/cse-sshfs/ssh-in.png alt="Getting a shell"></p><h2 id=setting-up-ssh-keys>Setting up SSH keys</h2><p>If you&rsquo;re being prompted for your password whenever using SSHFS or SSH, setting up a pair of SSH keys (if you haven&rsquo;t already) is probably a good idea. You can do this by following <strong>Part 4 and 5</strong> of the &lsquo;SSH and SSH keys&rsquo; section <a href=https://www.abiram.me/cse-setup#bonus-coins-avoiding-the-need-to-type-your-password-each-time target=_blank rel="noopener noreferrer">here</a>
.</p><h2 id=aliases>Aliases</h2><p>Typing in all these commands gets a bit cumbersome. We can use aliases to simplify this process a bit for us!</p><h3 id=determining-your-shell>Determining your shell</h3><p>Before we can figure out where to keep our aliases, we&rsquo;ll need to figure out what shell we&rsquo;re doing. In order to do this, run <code>echo $SHELL</code>.</p><p>It&rsquo;s likely that your shell is either bash or zsh (if not, you&rsquo;re probably cluey enough to figure the rest out yourself). If you&rsquo;re on bash, open or create the file <code>~/.bashrc</code>. If you&rsquo;re on zsh, open or create <code>~/.zshrc</code> in the text editor of your choice (eg. <code>code ~/.zshrc</code>).</p><h3 id=adding-our-aliases>Adding our aliases</h3><p>Create a newline at the end of the file you just opened, and paste in the following, being sure to replace with your own zID (also make sure to <strong>not</strong> add a space after the equals sign):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Your zID (change this)</span>
</span></span><span style=display:flex><span>_SSHFS_ZID<span style=color:#f92672>=</span>z5555555
</span></span><span style=display:flex><span><span style=color:#75715e># Your desired mountpoint for your CSE home directory</span>
</span></span><span style=display:flex><span>_SSHFS_CSE_MOUNT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/cse&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>alias csemnt<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;sshfs -o idmap=user -C </span><span style=color:#e6db74>${</span>_SSHFS_ZID<span style=color:#e6db74>}</span><span style=color:#e6db74>@login</span><span style=color:#e6db74>${</span>_SSHFS_ZID: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>.cse.unsw.edu.au: </span><span style=color:#e6db74>${</span>_SSHFS_CSE_MOUNT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>alias cseumount<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fusermount -zu </span><span style=color:#e6db74>${</span>_SSHFS_CSE_MOUNT<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> cse<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># determine where we are relative to the mountpoint (thanks @ralismark)</span>
</span></span><span style=display:flex><span>    local rel<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>PWD##<span style=color:#e6db74>${</span>_SSHFS_CSE_MOUNT<span style=color:#e6db74>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># if we don&#39;t have arguments, we give the user a shell on the remote cse machine.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PWD<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$rel<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># in the case that we&#39;re not in our mountpoint, provide a shell in their home directory.</span>
</span></span><span style=display:flex><span>            ssh <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>_SSHFS_ZID<span style=color:#e6db74>}</span><span style=color:#e6db74>@login</span><span style=color:#e6db74>${</span>_SSHFS_ZID: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>.cse.unsw.edu.au&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># if within the mountpoint, cd to the equivalent dir on the remote before providing a shell (thanks @ralismark)</span>
</span></span><span style=display:flex><span>            ssh <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>_SSHFS_ZID<span style=color:#e6db74>}</span><span style=color:#e6db74>@login</span><span style=color:#e6db74>${</span>_SSHFS_ZID: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>.cse.unsw.edu.au&#34;</span> -t <span style=color:#e6db74>&#34;cd </span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#34;%q&#34;</span>, <span style=color:#e6db74>&#34;./</span>$rel<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>; exec \$SHELL -l&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># if we have arguments, we have a command to execute.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$PWD<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$rel<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># in the case that we&#39;re not in our mountpoint, we&#39;ll execute in the home directory.</span>
</span></span><span style=display:flex><span>            ssh -qt <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>_SSHFS_ZID<span style=color:#e6db74>}</span><span style=color:#e6db74>@login</span><span style=color:#e6db74>${</span>_SSHFS_ZID: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>.cse.unsw.edu.au&#34;</span>, <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># if within the mountpoint, cd to the equivalent dir on the remote before executing (thanks @ralismark)</span>
</span></span><span style=display:flex><span>            ssh <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>_SSHFS_ZID<span style=color:#e6db74>}</span><span style=color:#e6db74>@login</span><span style=color:#e6db74>${</span>_SSHFS_ZID: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>.cse.unsw.edu.au&#34;</span> -qt <span style=color:#e6db74>&#34;cd </span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#34;%q&#34;</span>, <span style=color:#e6db74>&#34;./</span>$rel<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74> &amp;&amp; </span><span style=color:#66d9ef>$(</span>printf <span style=color:#e6db74>&#34;%q &#34;</span>, <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>You should now be able to open a new terminal (or run <code>exec bash</code> or <code>exec zsh</code> depending on which shell you use) and be able to enter <code>csemnt</code> to mount your CSE filesystem, and <code>cseumount</code> to unmount. You can also use <code>cse</code> to get a shell on CSE machines, and even directly run a single command by using <code>cse 1521 spim -f factorial.s</code> for example. It&rsquo;s worth noting that Git operations are particularly slow through SSH FS, so it&rsquo;s better to get a shell using <code>cse</code> and perform all your Git operations there.</p><p><img src=/assets/images/blog/cse-sshfs/alias.png alt="Using aliases yeet"></p><p>If this doesn&rsquo;t work, and you&rsquo;re on bash, make sure to check the relevant part of the troubleshooting section below.</p><h2 id=troubleshooting>Troubleshooting</h2><h4 id=mountpoint-not-empty>mountpoint not empty</h4><p>This suggests that you&rsquo;re trying to mount to the <code>~/cse</code> directory, despite it currently containing files in it, or perhaps being already mounted. If it&rsquo;s the former, remove these files or move them somewhere else if you need them.</p><h4 id=codeexe-invalid-argument>Code.exe: Invalid argument</h4><p>There&rsquo;s a weird WSL bug where the <code>code</code> command may not work if you&rsquo;re in the <code>~/cse</code> directory, so you may need to run it from outside - that is, try <code>cd ~ && code ~/cse/path/to/file-or-directory</code>.</p><h4 id=aliases-in-bashrc-dont-work>Aliases in <code>.bashrc</code> don&rsquo;t work</h4><p>There&rsquo;s a chance that your terminal isn&rsquo;t set up to automatically source <code>.bashrc</code>. To fix this, open <code>~/.profile</code>, add a newline to the end of the file and paste the following in:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$BASH_VERSION<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.bashrc&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    source <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.bashrc&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><h2 id=have-feedback-or-want-to-reach-out>Have feedback, or want to reach out?</h2><p>If you&rsquo;ve spotted an error, or have any suggestions or improvements that I can make, feel free to contact me! You can find details at the bottom of this page.</p><h2 id=acknowledgements>Acknowledgements</h2><p>While I&rsquo;ve vaguely known SSHFS has existed for a bit, I never thought to use it until Nicholas Berridge-Argent published a guide to using SSHFS with CSE <a href=https://nickba.dev/misc/cse-sshfs.html target=_blank rel="noopener noreferrer">here</a>
. I&rsquo;ve been using SSHFS ever since, although the only times I really use CSE machines is if I need to demo something on SPIM. This guide merely expands on Nick&rsquo;s guide, and a massive shoutout goes to him here!</p><p>Thanks to <a href=https://github.com/ralismark target=_blank rel="noopener noreferrer">@ralismark</a>
for their useful feedback (such as pointing out lazy unmounting exists), and for their scripts to easily run commands and get a shell on the remote machine.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>This gets worse as you add more extensions. We once spotted someone using a Java language extension eating up nearly a gigabyte of RAM on its own.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>There are definitely ways to get SSHFS working natively on Windows, but they&rsquo;re a lot messier, and setting up WSL is definitely advisable.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>I personally much prefer this setup over both the VS Code Remote-SSH and SSHFS extensions just because it seamlessly interfaces with WSL, which is my regular coding setup.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Make sure to have the &lsquo;Remote - WSL&rsquo; extension installed in VS Code. There&rsquo;s also a weird WSL bug where the <code>code</code> command may not work if you&rsquo;re in the <code>~/cse</code> directory, so you may need to run it from outside.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>It&rsquo;s not the worst thing in the world if you forget/are unable to unmount, but you&rsquo;ll be using up some resources both on your own computer as well as CSE computers.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><script src=https://utteranc.es/client.js repo=abiramen/site-utterances issue-term=pathname label=utteranc.es theme=preferred-color-scheme crossorigin=anonymous async></script></div><script src=/assets/vendor/littlefoot/littlefoot.js></script><script type=application/javascript>typeof littlefoot!="undefined"&&littlefoot.default()</script></main><footer><div id=footer-content><div id=contact><a href=https://github.com/abiramen target=_blank>github: @abiramen</a><br>discord: @abiramen<br>println!("Email: {}@{}", "hello", "abiram.me");<br></div><div class=centre id=love-and-ramen style=margin-bottom:.5rem>made with <span class=icon>favorite</span> and ramen by Abiram</div><img src=/assets/images/ramen-logo.png id=ramen-footer width=75px alt=logo><div id=footer-flavour>Hmmm... we might have defeated the most basic of email scrapers. I bet AI would figure us out though.</div></div></footer><script src=/assets/js/common.js></script><script src=/assets/js/navbar.js></script></body></html>